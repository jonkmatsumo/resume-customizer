openapi: 3.0.3
info:
  title: Resume Customizer API
  description: |
    Resume Customizer exposes a REST API for triggering the resume-tailoring pipeline, tracking runs,
    and retrieving artifacts (including the generated LaTeX resume).

    The endpoints and their descriptions are based on the repository README's REST API section.

    ## Response Headers

    ### Rate Limiting Headers
    All responses include rate limiting headers (when rate limiting is enabled):
    - `X-RateLimit-Limit` (integer): Maximum requests allowed in the window
    - `X-RateLimit-Remaining` (integer): Remaining requests in the current window
    - `X-RateLimit-Reset` (integer, Unix timestamp): Time when the rate limit window resets
    - `Retry-After` (integer, seconds): Present when rate limit is exceeded (429 Too Many Requests response)

    ### CORS Headers
    All responses include CORS headers to support cross-origin requests:
    - `Access-Control-Allow-Origin`: Set to `*` for all origins
    - `Access-Control-Allow-Methods`: Allowed HTTP methods (GET, POST, PUT, DELETE, OPTIONS)
    - `Access-Control-Allow-Headers`: Allowed request headers (Content-Type, Authorization)
    - `Access-Control-Allow-Credentials`: Set to `true`
  version: "0.1.0"

servers:
  - url: http://localhost:8080/v1
    description: Local development (v1 API)
  - url: http://localhost:8080
    description: Legacy endpoints (deprecated)

tags:
  - name: health
    description: Health checks
  - name: authentication
    description: User authentication and password management
  - name: pipeline
    description: Start pipeline runs (background or streaming)
  - name: runs
    description: Run listing, status, and lifecycle
  - name: artifacts
    description: Artifact listing and retrieval
  - name: users
    description: User profile CRUD
  - name: jobs
    description: Employment history CRUD
  - name: experiences
    description: Experience bullet CRUD
  - name: education
    description: Education history CRUD
  - name: companies
    description: Company information and domains
  - name: company-profiles
    description: Company research profiles, style rules, and values
  - name: job-postings
    description: Job posting endpoints
  - name: job-profiles
    description: Job profile endpoints
  - name: crawled-pages
    description: Crawled page endpoints
  - name: experience-bank
    description: Experience bank endpoints for user stories, bullets, and skills
  - name: pipeline-steps
    description: Step-by-step pipeline execution with checkpoint support

paths:
  /health:
    get:
      tags: [health]
      summary: Health check
      description: Returns service liveness.
      operationId: getHealth
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /v1/auth/register:
    post:
      tags: [authentication]
      summary: Register a new user
      description: Creates a new user account with email and password
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/auth/login:
    post:
      tags: [authentication]
      summary: Login user
      description: Authenticates a user and returns a JWT token
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "#/components/responses/InternalError"


  /run:
    post:
      deprecated: true
      tags: [pipeline]
      summary: Start pipeline (background)
      description: |
        **DEPRECATED**: This endpoint is deprecated. Use `POST /v1/runs` instead.
        
        Starts the pipeline asynchronously and returns a run ID immediately.
      operationId: startRun
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RunCreateRequest"
            examples:
              basic:
                summary: Start a run from a job URL
                value:
                  user_id: "550e8400-e29b-41d4-a716-446655440000"
                  job_url: "https://www.linkedin.com/jobs/view/123456789"
      responses:
        "202":
          description: Accepted (run started)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunCreateResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /run/stream:
    post:
      deprecated: true
      tags: [pipeline]
      summary: Start pipeline (SSE)
      description: |
        **DEPRECATED**: This endpoint is deprecated. Use the step-by-step pipeline API (`POST /v1/runs` with step execution) instead.
        
        Starts the pipeline and streams progress events using Server-Sent Events (SSE).
      operationId: startRunStream
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RunCreateRequest"
      responses:
        "200":
          description: |
            SSE stream of progress events. The first event will always be `run_started`
            containing the `run_id` for tracking. Subsequent events are `step` events
            for pipeline progress, followed by `complete` or `error` at the end.
          content:
            text/event-stream:
              schema:
                $ref: "#/components/schemas/SseEvent"
              examples:
                run_started:
                  summary: First event with run_id for tracking
                  value: |
                    event: step
                    data: {"step":"run_started","category":"lifecycle","message":"Pipeline run started","run_id":"550e8400-e29b-41d4-a716-446655440000"}
                progress:
                  summary: Subsequent pipeline progress events
                  value: |
                    event: step
                    data: {"step":"job_profile","category":"ingestion","message":"Parsed job profile: Software Engineer at Acme Corp"}
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /status/{id}:
    get:
      deprecated: true
      tags: [runs]
      summary: Get run status (legacy)
      description: |
        **DEPRECATED**: This endpoint is deprecated. Use `GET /v1/status/{id}` or `GET /v1/runs/{id}` instead.
        
        Returns status, company, role (and other metadata) for a run.
      operationId: getRunStatusLegacy
      parameters:
        - $ref: "#/components/parameters/RunIdPath"
      responses:
        "200":
          description: Run status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunStatus"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /artifact/{id}:
    get:
      deprecated: true
      tags: [artifacts]
      summary: Get artifact by ID (legacy)
      description: |
        **DEPRECATED**: This endpoint is deprecated. Use `GET /v1/artifact/{id}` instead.
        
        Returns full artifact JSON content.
      operationId: getArtifactLegacy
      parameters:
        - $ref: "#/components/parameters/ArtifactIdPath"
      responses:
        "200":
          description: Full artifact
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs:
    get:
      tags: [runs]
      summary: List all runs
      description: Lists pipeline runs with optional filters.
      operationId: listRuns
      parameters:
        - in: query
          name: company
          schema: { type: string }
          description: Filter by company name
        - in: query
          name: status
          schema:
            type: string
            enum: [queued, running, completed, failed, canceled]
          description: Filter by run status
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 500
            default: 50
          description: Max number of runs to return
      responses:
        "200":
          description: A list of runs
          content:
            application/json:
              schema:
                type: object
                properties:
                  runs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        company:
                          type: string
                        role_title:
                          type: string
                        status:
                          type: string
                          enum: [queued, running, completed, failed, canceled]
                        created_at:
                          type: string
                          format: date-time
                      required: [id, company, role_title, status, created_at]
                  count:
                    type: integer
                    description: Total number of runs returned
                required: [runs, count]
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/status/{id}:
    get:
      tags: [runs]
      summary: Get run status
      description: Returns status, company, role (and other metadata) for a run.
      operationId: getRunStatus
      parameters:
        - $ref: "#/components/parameters/RunIdPath"
      responses:
        "200":
          description: Run status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunStatus"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{id}:
    get:
      tags: [runs]
      summary: Get run by ID
      description: Returns complete run metadata including user_id, company, role_title, job_url, status, and timestamps.
      operationId: getRun
      parameters:
        - $ref: "#/components/parameters/RunIdPath"
      responses:
        "200":
          description: Run details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunGetResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    delete:
      tags: [runs]
      summary: Delete run
      description: Deletes a run and cascades deletion to associated artifacts.
      operationId: deleteRun
      parameters:
        - $ref: "#/components/parameters/RunIdPath"
      responses:
        "204":
          description: Deleted
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/artifacts:
    get:
      tags: [artifacts]
      summary: List artifacts
      description: Lists artifacts with optional filters.
      operationId: listArtifacts
      parameters:
        - in: query
          name: run_id
          schema: { type: string, format: uuid }
          description: Filter by run ID
        - in: query
          name: step
          schema: { type: string }
          description: Filter by pipeline step
        - in: query
          name: category
          schema: { type: string }
          description: Filter by artifact category
      responses:
        "200":
          description: A list of artifacts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ArtifactSummary"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/artifact/{id}:
    get:
      tags: [artifacts]
      summary: Get artifact by ID
      description: Returns full artifact JSON content.
      operationId: getArtifact
      parameters:
        - $ref: "#/components/parameters/ArtifactIdPath"
      responses:
        "200":
          description: Full artifact
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Artifact"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{id}/artifacts:
    get:
      tags: [artifacts]
      summary: List artifacts for a run
      description: Lists artifacts for a single run (summary view).
      operationId: listRunArtifacts
      parameters:
        - $ref: "#/components/parameters/RunIdPath"
      responses:
        "200":
          description: A list of artifacts for the run
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ArtifactSummary"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{id}/resume.tex:
    get:
      tags: [artifacts]
      summary: Get LaTeX resume
      description: |
        Returns the generated LaTeX resume for a run as plain text.
        
        By default, triggers a download with `Content-Disposition: attachment; filename=resume.tex`.
        Use `view=true` query parameter to display the content in-browser without triggering a download.
      operationId: getResumeTex
      parameters:
        - $ref: "#/components/parameters/RunIdPath"
        - name: view
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: When true, displays content in browser without download header
      responses:
        "200":
          description: LaTeX document
          headers:
            Content-Disposition:
              description: Present only when view=false (default). Triggers file download.
              schema:
                type: string
                example: attachment; filename=resume.tex
          content:
            text/plain:
              schema:
                type: string
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users:
    post:
      tags: [users]
      summary: Create user
      description: Creates a user profile.
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCreateRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}:
    get:
      tags: [users]
      summary: Get user
      description: Returns a user profile.
      operationId: getUser
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: User profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    put:
      tags: [users]
      summary: Update user
      description: Updates a user profile.
      operationId: updateUser
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdateRequest"
      responses:
        "200":
          description: Updated user profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/password:
    put:
      tags: [authentication]
      summary: Update user password
      description: Updates the password for a specific user. The authenticated user must match the user ID in the path.
      operationId: updateUserPassword
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePasswordRequest"
      responses:
        "200":
          description: Password updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password updated successfully
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Unauthorized (invalid token)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden (cannot update another user's password)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/jobs:
    get:
      tags: [jobs]
      summary: List jobs
      description: Lists employment history for a user.
      operationId: listJobs
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: Jobs
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Job" }
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/runs:
    get:
      tags: [runs]
      summary: List user runs
      description: Lists pipeline runs for a specific user. The authenticated user must match the user ID in the path.
      operationId: listUserRuns
      security:
        - bearerAuth: []
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - in: query
          name: company
          schema: { type: string }
          description: Filter by company name
        - in: query
          name: status
          schema:
            type: string
            enum: [queued, running, completed, failed, canceled]
          description: Filter by run status
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 500
            default: 50
          description: Max number of runs to return
      responses:
        "200":
          description: A list of runs
          content:
            application/json:
              schema:
                type: object
                properties:
                  runs:
                    type: array
                    items:
                      $ref: "#/components/schemas/Run"
                  count:
                    type: integer
                    description: Total number of runs returned
                required:
                  - runs
                  - count
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          description: Unauthorized (invalid token)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "403":
          description: Forbidden (cannot view another user's runs)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags: [jobs]
      summary: Create job
      description: Creates a job (employment entry) for a user.
      operationId: createJob
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JobCreateRequest"
      responses:
        "201":
          description: Created job
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Job"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/jobs/{id}:
    put:
      tags: [jobs]
      summary: Update job
      description: Updates a job.
      operationId: updateJob
      parameters:
        - $ref: "#/components/parameters/JobIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JobUpdateRequest"
      responses:
        "200":
          description: Updated job
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Job"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      tags: [jobs]
      summary: Delete job
      description: Deletes a job and its experiences.
      operationId: deleteJob
      parameters:
        - $ref: "#/components/parameters/JobIdPath"
      responses:
        "204":
          description: Deleted
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/jobs/{id}/experiences:
    get:
      tags: [experiences]
      summary: List experiences
      description: Lists bullet-point experiences for a job.
      operationId: listExperiences
      parameters:
        - $ref: "#/components/parameters/JobIdPath"
      responses:
        "200":
          description: Experiences
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Experience" }
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags: [experiences]
      summary: Add experience
      description: Adds an experience bullet to a job.
      operationId: createExperience
      parameters:
        - $ref: "#/components/parameters/JobIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExperienceCreateRequest"
      responses:
        "201":
          description: Created experience
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Experience"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/experiences/{id}:
    put:
      tags: [experiences]
      summary: Update experience
      description: Updates an experience bullet.
      operationId: updateExperience
      parameters:
        - $ref: "#/components/parameters/ExperienceIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExperienceUpdateRequest"
      responses:
        "200":
          description: Updated experience
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Experience"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      tags: [experiences]
      summary: Delete experience
      description: Deletes an experience bullet.
      operationId: deleteExperience
      parameters:
        - $ref: "#/components/parameters/ExperienceIdPath"
      responses:
        "204":
          description: Deleted
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/education:
    get:
      tags: [education]
      summary: List education
      description: Lists education history for a user.
      operationId: listEducation
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: Education entries
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Education" }
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    post:
      tags: [education]
      summary: Add education
      description: Adds an education entry for a user.
      operationId: createEducation
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EducationCreateRequest"
      responses:
        "201":
          description: Created education entry
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Education"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/education/{id}:
    put:
      tags: [education]
      summary: Update education
      description: Updates an education entry.
      operationId: updateEducation
      parameters:
        - $ref: "#/components/parameters/EducationIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EducationUpdateRequest"
      responses:
        "200":
          description: Updated education entry
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Education"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

    delete:
      tags: [education]
      summary: Delete education
      description: Deletes an education entry.
      operationId: deleteEducation
      parameters:
        - $ref: "#/components/parameters/EducationIdPath"
      responses:
        "204":
          description: Deleted
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/experience-bank:
    get:
      tags: [users]
      summary: Export experience bank
      description: Exports the user's experience bank JSON in a pipeline-compatible format.
      operationId: exportExperienceBank
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: Experience bank export
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExperienceBankExport"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/experience-bank/stories:
    get:
      tags: [experience-bank]
      summary: List stories for user
      description: Returns all stories for a specific user
      operationId: listStories
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StoryListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/experience-bank/stories/{story_id}:
    get:
      tags: [experience-bank]
      summary: Get story by ID
      description: Returns a single story by its UUID, scoped to the user
      operationId: getStory
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - in: path
          name: story_id
          required: true
          schema:
            type: string
            format: uuid
          description: Story ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Story"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/experience-bank/stories/{story_id}/bullets:
    get:
      tags: [experience-bank]
      summary: Get bullets for a story
      description: Returns all bullets for a specific story
      operationId: getStoryBullets
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - in: path
          name: story_id
          required: true
          schema:
            type: string
            format: uuid
          description: Story ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BulletListResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/experience-bank/skills:
    get:
      tags: [experience-bank]
      summary: List skills for user
      description: Returns all unique skills used by the user across all their stories
      operationId: listSkills
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SkillListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/users/{id}/experience-bank/skills/{skill_id}/bullets:
    get:
      tags: [experience-bank]
      summary: Get bullets with a specific skill
      description: Returns all bullets that use a specific skill, scoped to the user
      operationId: getSkillBullets
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - in: path
          name: skill_id
          required: true
          schema:
            type: string
            format: uuid
          description: Skill ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BulletListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies:
    get:
      tags: [companies]
      summary: List all companies with research profiles
      description: Returns a paginated list of companies that have research profiles
      operationId: listCompanies
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CompanyListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{id}:
    get:
      tags: [companies]
      summary: Get company by ID
      description: Returns a single company by its UUID
      operationId: getCompany
      parameters:
        - $ref: "#/components/parameters/CompanyIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Company"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/by-name:
    get:
      tags: [companies]
      summary: Get company by normalized name
      description: Returns a company by its normalized name (uses query parameter)
      operationId: getCompanyByName
      parameters:
        - name: name
          in: query
          required: true
          schema:
            type: string
          description: Company name (will be normalized)
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Company"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{id}/domains:
    get:
      tags: [companies]
      summary: List domains for a company
      description: Returns all domains associated with a company
      operationId: listCompanyDomains
      parameters:
        - $ref: "#/components/parameters/CompanyIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  domains:
                    type: array
                    items:
                      $ref: "#/components/schemas/CompanyDomain"
                  count:
                    type: integer
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{company_id}/profile:
    get:
      tags: [company-profiles]
      summary: Get company profile
      description: Returns the research profile for a company
      operationId: getCompanyProfile
      parameters:
        - in: path
          name: company_id
          required: true
          schema:
            type: string
            format: uuid
          description: Company ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CompanyProfile"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{company_id}/profile/style-rules:
    get:
      tags: [company-profiles]
      summary: Get style rules for company
      description: Returns style rules extracted from the company profile
      operationId: getStyleRules
      parameters:
        - in: path
          name: company_id
          required: true
          schema:
            type: string
            format: uuid
          description: Company ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  style_rules:
                    type: array
                    items:
                      $ref: "#/components/schemas/CompanyStyleRule"
                  count:
                    type: integer
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{company_id}/profile/taboo-phrases:
    get:
      tags: [company-profiles]
      summary: Get taboo phrases for company
      description: Returns phrases to avoid based on company profile
      operationId: getTabooPhrases
      parameters:
        - in: path
          name: company_id
          required: true
          schema:
            type: string
            format: uuid
          description: Company ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  taboo_phrases:
                    type: array
                    items:
                      $ref: "#/components/schemas/CompanyTabooPhrase"
                  count:
                    type: integer
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{company_id}/profile/values:
    get:
      tags: [company-profiles]
      summary: Get company values
      description: Returns core values extracted from company profile
      operationId: getCompanyValues
      parameters:
        - in: path
          name: company_id
          required: true
          schema:
            type: string
            format: uuid
          description: Company ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  values:
                    type: array
                    items:
                      $ref: "#/components/schemas/CompanyValue"
                  count:
                    type: integer
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{company_id}/profile/sources:
    get:
      tags: [company-profiles]
      summary: Get evidence URLs for company profile
      description: Returns URLs used as evidence for the company profile
      operationId: getProfileSources
      parameters:
        - in: path
          name: company_id
          required: true
          schema:
            type: string
            format: uuid
          description: Company ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  sources:
                    type: array
                    items:
                      $ref: "#/components/schemas/CompanyProfileSource"
                  count:
                    type: integer
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-postings:
    get:
      tags: [job-postings]
      summary: List job postings
      description: Returns a paginated list of job postings with optional filters
      operationId: listJobPostings
      parameters:
        - $ref: "#/components/parameters/PlatformQuery"
        - $ref: "#/components/parameters/CompanyIdQuery"
        - $ref: "#/components/parameters/LimitQuery"
        - $ref: "#/components/parameters/OffsetQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobPostingListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-postings/{id}:
    get:
      tags: [job-postings]
      summary: Get job posting by ID
      description: Returns a single job posting by its UUID
      operationId: getJobPosting
      parameters:
        - $ref: "#/components/parameters/JobPostingIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobPosting"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-postings/by-url:
    get:
      tags: [job-postings]
      summary: Get job posting by URL
      description: Returns a job posting by its URL
      operationId: getJobPostingByURL
      parameters:
        - name: url
          in: query
          required: true
          schema:
            type: string
            format: uri
          description: Job posting URL
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobPosting"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{company_id}/job-postings:
    get:
      tags: [job-postings]
      summary: List job postings for a company
      description: Returns all job postings associated with a company
      operationId: listJobPostingsByCompany
      parameters:
        - in: path
          name: company_id
          required: true
          schema:
            type: string
            format: uuid
          description: Company ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  postings:
                    type: array
                    items:
                      $ref: "#/components/schemas/JobPosting"
                  count:
                    type: integer
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-profiles/{id}:
    get:
      tags: [job-profiles]
      summary: Get job profile by ID
      description: Returns a single job profile by its UUID
      operationId: getJobProfile
      parameters:
        - $ref: "#/components/parameters/JobProfileIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobProfile"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-postings/{posting_id}/profile:
    get:
      tags: [job-profiles]
      summary: Get job profile for a posting
      description: Returns the job profile associated with a job posting
      operationId: getJobProfileByPostingID
      parameters:
        - $ref: "#/components/parameters/PostingIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobProfile"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-profiles/{id}/requirements:
    get:
      tags: [job-profiles]
      summary: Get requirements for a job profile
      description: Returns all requirements (hard and nice-to-have) for a job profile
      operationId: getRequirements
      parameters:
        - $ref: "#/components/parameters/JobProfileIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobRequirementListResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-profiles/{id}/responsibilities:
    get:
      tags: [job-profiles]
      summary: Get responsibilities for a job profile
      description: Returns all responsibilities for a job profile
      operationId: getResponsibilities
      parameters:
        - $ref: "#/components/parameters/JobProfileIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobResponsibilityListResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/job-profiles/{id}/keywords:
    get:
      tags: [job-profiles]
      summary: Get keywords for a job profile
      description: Returns all keywords for a job profile
      operationId: getKeywords
      parameters:
        - $ref: "#/components/parameters/JobProfileIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobKeywordListResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/crawled-pages/{id}:
    get:
      tags: [crawled-pages]
      summary: Get crawled page by ID
      description: Returns a crawled page by its UUID. By default, excludes the `raw_html` field. Use `include_html=true` query parameter to include it.
      operationId: getCrawledPage
      parameters:
        - $ref: "#/components/parameters/CrawledPageIdPath"
        - name: include_html
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Include raw HTML content in response
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CrawledPage"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/crawled-pages/by-url:
    get:
      tags: [crawled-pages]
      summary: Get crawled page by URL
      description: Returns a crawled page by its URL. By default, excludes the `raw_html` field. Use `include_html=true` query parameter to include it.
      operationId: getCrawledPageByURL
      parameters:
        - name: url
          in: query
          required: true
          schema:
            type: string
            format: uri
          description: Page URL
        - name: include_html
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Include raw HTML content in response
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CrawledPage"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/companies/{company_id}/crawled-pages:
    get:
      tags: [crawled-pages]
      summary: List crawled pages for a company
      description: Returns all crawled pages associated with a company. The `raw_html` field is never included in list responses.
      operationId: listCrawledPagesByCompany
      parameters:
        - in: path
          name: company_id
          required: true
          schema:
            type: string
            format: uuid
          description: Company ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CrawledPageListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{run_id}/steps:
    get:
      tags: [pipeline-steps]
      summary: List all steps for a run
      description: Returns all pipeline steps for a run with their status, timing, and artifacts. Includes optional run metadata (company, role_title, created_at) to reduce frontend API calls.
      operationId: listRunSteps
      parameters:
        - in: path
          name: run_id
          required: true
          schema:
            type: string
            format: uuid
          description: Run ID
        - in: query
          name: status
          required: false
          schema:
            type: string
            enum: [pending, in_progress, completed, failed, skipped, blocked]
          description: Filter steps by status
        - in: query
          name: category
          required: false
          schema:
            type: string
          description: Filter steps by category
      responses:
        "200":
          description: List of steps with status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunStepsListResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{run_id}/steps/{step_name}:
    get:
      tags: [pipeline-steps]
      summary: Get step status
      description: Returns the status of a specific pipeline step
      operationId: getStepStatus
      parameters:
        - in: path
          name: run_id
          required: true
          schema:
            type: string
            format: uuid
          description: Run ID
        - in: path
          name: step_name
          required: true
          schema:
            type: string
          description: Step name
      responses:
        "200":
          description: Step status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StepStatusResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      tags: [pipeline-steps]
      summary: Execute a step
      description: Executes a specific pipeline step
      operationId: executeStep
      parameters:
        - in: path
          name: run_id
          required: true
          schema:
            type: string
            format: uuid
          description: Run ID
        - in: path
          name: step_name
          required: true
          schema:
            type: string
          description: Step name
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StepExecuteRequest"
      responses:
        "200":
          description: Step execution result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StepExecuteResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{run_id}/steps/{step_name}/skip:
    post:
      tags: [pipeline-steps]
      summary: Skip a step
      description: Marks a step as skipped
      operationId: skipStep
      parameters:
        - in: path
          name: run_id
          required: true
          schema:
            type: string
            format: uuid
          description: Run ID
        - in: path
          name: step_name
          required: true
          schema:
            type: string
          description: Step name
      responses:
        "200":
          description: Step skipped
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StepExecuteResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{run_id}/steps/{step_name}/retry:
    post:
      tags: [pipeline-steps]
      summary: Retry a failed step
      description: Retries a previously failed step
      operationId: retryStep
      parameters:
        - in: path
          name: run_id
          required: true
          schema:
            type: string
            format: uuid
          description: Run ID
        - in: path
          name: step_name
          required: true
          schema:
            type: string
          description: Step name
      responses:
        "200":
          description: Step retry result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StepExecuteResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{run_id}/checkpoint:
    get:
      tags: [pipeline-steps]
      summary: Get checkpoint
      description: Returns the current checkpoint state for a run
      operationId: getCheckpoint
      parameters:
        - in: path
          name: run_id
          required: true
          schema:
            type: string
            format: uuid
          description: Run ID
      responses:
        "200":
          description: Checkpoint state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CheckpointGetResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

  /v1/runs/{run_id}/resume:
    post:
      tags: [pipeline-steps]
      summary: Resume from checkpoint
      description: Resumes pipeline execution from the last checkpoint
      operationId: resumeFromCheckpoint
      parameters:
        - in: path
          name: run_id
          required: true
          schema:
            type: string
            format: uuid
          description: Run ID
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResumeRequest"
      responses:
        "200":
          description: Resume result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResumeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /v1/auth/login or /v1/auth/register

  parameters:
    RunIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Run ID

    ArtifactIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Artifact ID

    UserIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: User ID

    JobIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Job ID

    ExperienceIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Experience ID

    EducationIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Education ID

    CompanyIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Company ID

    JobPostingIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Job posting ID

    JobProfileIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Job profile ID

    PostingIdPath:
      in: path
      name: posting_id
      required: true
      schema:
        type: string
        format: uuid
      description: Job posting ID

    PlatformQuery:
      name: platform
      in: query
      required: false
      schema:
        type: string
        enum: [greenhouse, lever, linkedin, workday, ashby, unknown]
      description: Filter by platform

    CompanyIdQuery:
      name: company_id
      in: query
      required: false
      schema:
        type: string
        format: uuid
      description: Filter by company ID

    LimitQuery:
      name: limit
      in: query
      required: false
      schema:
        type: integer
        default: 50
        maximum: 100
        minimum: 1
      description: Pagination limit

    OffsetQuery:
      name: offset
      in: query
      required: false
      schema:
        type: integer
        default: 0
        minimum: 0
      description: Pagination offset

    CrawledPageIdPath:
      in: path
      name: id
      required: true
      schema:
        type: string
        format: uuid
      description: Crawled page ID

  headers:
    RateLimitLimit:
      description: Maximum requests allowed in the rate limit window
      schema:
        type: integer
        example: 1000
    RateLimitRemaining:
      description: Remaining requests in the current rate limit window
      schema:
        type: integer
        example: 999
    RateLimitReset:
      description: Unix timestamp indicating when the rate limit window resets
      schema:
        type: integer
        format: int64
        example: 1609459200
    RetryAfter:
      description: Number of seconds to wait before retrying the request (present in 429 responses)
      schema:
        type: integer
        example: 60
    AccessControlAllowOrigin:
      description: Indicates which origins are allowed to access the resource
      schema:
        type: string
        example: "*"
    AccessControlAllowMethods:
      description: Comma-separated list of allowed HTTP methods
      schema:
        type: string
        example: "GET, POST, PUT, DELETE, OPTIONS"
    AccessControlAllowHeaders:
      description: Comma-separated list of allowed request headers
      schema:
        type: string
        example: "Content-Type, Authorization"
    AccessControlAllowCredentials:
      description: Indicates whether credentials can be included in the request
      schema:
        type: string
        enum: ["true"]
        example: "true"

  responses:
    BadRequest:
      description: Bad request
      headers:
        X-RateLimit-Limit:
          $ref: "#/components/headers/RateLimitLimit"
        X-RateLimit-Remaining:
          $ref: "#/components/headers/RateLimitRemaining"
        X-RateLimit-Reset:
          $ref: "#/components/headers/RateLimitReset"
        Access-Control-Allow-Origin:
          $ref: "#/components/headers/AccessControlAllowOrigin"
        Access-Control-Allow-Methods:
          $ref: "#/components/headers/AccessControlAllowMethods"
        Access-Control-Allow-Headers:
          $ref: "#/components/headers/AccessControlAllowHeaders"
        Access-Control-Allow-Credentials:
          $ref: "#/components/headers/AccessControlAllowCredentials"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            bad_request:
              value:
                error: bad_request
                message: Invalid request payload

    NotFound:
      description: Not found
      headers:
        X-RateLimit-Limit:
          $ref: "#/components/headers/RateLimitLimit"
        X-RateLimit-Remaining:
          $ref: "#/components/headers/RateLimitRemaining"
        X-RateLimit-Reset:
          $ref: "#/components/headers/RateLimitReset"
        Access-Control-Allow-Origin:
          $ref: "#/components/headers/AccessControlAllowOrigin"
        Access-Control-Allow-Methods:
          $ref: "#/components/headers/AccessControlAllowMethods"
        Access-Control-Allow-Headers:
          $ref: "#/components/headers/AccessControlAllowHeaders"
        Access-Control-Allow-Credentials:
          $ref: "#/components/headers/AccessControlAllowCredentials"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            not_found:
              value:
                error: not_found
                message: Resource not found

    InternalError:
      description: Internal server error
      headers:
        X-RateLimit-Limit:
          $ref: "#/components/headers/RateLimitLimit"
        X-RateLimit-Remaining:
          $ref: "#/components/headers/RateLimitRemaining"
        X-RateLimit-Reset:
          $ref: "#/components/headers/RateLimitReset"
        Access-Control-Allow-Origin:
          $ref: "#/components/headers/AccessControlAllowOrigin"
        Access-Control-Allow-Methods:
          $ref: "#/components/headers/AccessControlAllowMethods"
        Access-Control-Allow-Headers:
          $ref: "#/components/headers/AccessControlAllowHeaders"
        Access-Control-Allow-Credentials:
          $ref: "#/components/headers/AccessControlAllowCredentials"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            internal_error:
              value:
                error: internal_error
                message: Unexpected error

    TooManyRequests:
      description: Rate limit exceeded
      headers:
        X-RateLimit-Limit:
          $ref: "#/components/headers/RateLimitLimit"
        X-RateLimit-Remaining:
          $ref: "#/components/headers/RateLimitRemaining"
        X-RateLimit-Reset:
          $ref: "#/components/headers/RateLimitReset"
        Retry-After:
          $ref: "#/components/headers/RetryAfter"
        Access-Control-Allow-Origin:
          $ref: "#/components/headers/AccessControlAllowOrigin"
        Access-Control-Allow-Methods:
          $ref: "#/components/headers/AccessControlAllowMethods"
        Access-Control-Allow-Headers:
          $ref: "#/components/headers/AccessControlAllowHeaders"
        Access-Control-Allow-Credentials:
          $ref: "#/components/headers/AccessControlAllowCredentials"
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            too_many_requests:
              value:
                error: too_many_requests
                message: Rate limit exceeded. Please retry after the time specified in Retry-After header.

  schemas:
    HealthResponse:
      type: object
      additionalProperties: false
      properties:
        status:
          type: string
          example: ok
      required: [status]

    RunCreateRequest:
      type: object
      description: Request body to start a pipeline run (step-by-step execution).
      properties:
        user_id:
          type: string
          format: uuid
          description: UUID of the user profile in DB (REQUIRED)
        job_url:
          type: string
          format: uri
          description: URL of the job posting (required if job_text not provided)
        job_text:
          type: string
          description: Raw job posting text (required if job_url not provided)
        template:
          type: string
          description: Path to LaTeX template
          default: templates/one_page_resume.tex
        max_bullets:
          type: integer
          minimum: 1
          description: Target number of bullets
          default: 25
        max_lines:
          type: integer
          minimum: 1
          description: Target number of lines
          default: 35
      required: [user_id]
      oneOf:
        - required: [job_url]
        - required: [job_text]

    RunCreateResponse:
      type: object
      additionalProperties: false
      properties:
        run_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running]
          description: Initial status
        created_at:
          type: string
          format: date-time
          description: Run creation timestamp
        steps:
          type: object
          properties:
            completed:
              type: array
              items:
                type: string
              description: List of completed step names
            available:
              type: array
              items:
                type: string
              description: List of available step names
            blocked:
              type: array
              items:
                type: string
              description: List of blocked step names
          required: [completed, available, blocked]
      required: [run_id, status, created_at, steps]

    Run:
      type: object
      description: A pipeline run.
      properties:
        id:
          type: string
          format: uuid
        company:
          type: string
          nullable: true
        role:
          type: string
          nullable: true
        status:
          type: string
          enum: [queued, running, completed, failed, canceled]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, status, created_at, updated_at]

    RunStatus:
      allOf:
        - $ref: "#/components/schemas/Run"
        - type: object
          properties:
            message:
              type: string
              nullable: true
              description: Optional status message / error reason

    ArtifactSummary:
      type: object
      description: Artifact summary row returned by list endpoints.
      properties:
        id:
          type: string
          format: uuid
        run_id:
          type: string
          format: uuid
        step:
          type: string
        category:
          type: string
        created_at:
          type: string
          format: date-time
      required: [id, run_id, step, category, created_at]

    Artifact:
      type: object
      description: Full artifact JSON record.
      properties:
        id:
          type: string
          format: uuid
        run_id:
          type: string
          format: uuid
        step:
          type: string
        category:
          type: string
        content:
          description: Arbitrary JSON content stored for this artifact.
          nullable: true
        created_at:
          type: string
          format: date-time
      required: [id, run_id, step, category, content, created_at]

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
          nullable: true
        phone:
          type: string
          nullable: true
        password_set:
          type: boolean
          description: Indicates if user has set a password
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, name, created_at, updated_at]

    UserCreateRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
      required: [name]

    UserUpdateRequest:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
      additionalProperties: false

    Job:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        company:
          type: string
        role_title:
          type: string
        location:
          type: string
          nullable: true
        start_date:
          type: string
          nullable: true
          description: Free-form or ISO date, depending on your implementation
        end_date:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, user_id, company, role_title, created_at, updated_at]

    JobCreateRequest:
      type: object
      properties:
        company:
          type: string
        role_title:
          type: string
        location:
          type: string
        start_date:
          type: string
        end_date:
          type: string
      required: [company, role_title]

    JobUpdateRequest:
      type: object
      properties:
        company:
          type: string
        role_title:
          type: string
        location:
          type: string
        start_date:
          type: string
        end_date:
          type: string
      additionalProperties: false

    Experience:
      type: object
      properties:
        id:
          type: string
          format: uuid
        job_id:
          type: string
          format: uuid
        bullet_text:
          type: string
        skills:
          type: array
          items:
            type: string
          description: Skill tags associated with the bullet
        risk_flags:
          type: array
          items:
            type: string
          description: Optional flags (e.g., overclaim risk)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, job_id, bullet_text, created_at, updated_at]

    ExperienceCreateRequest:
      type: object
      properties:
        bullet_text:
          type: string
        skills:
          type: array
          items: { type: string }
        risk_flags:
          type: array
          items: { type: string }
      required: [bullet_text]

    ExperienceUpdateRequest:
      type: object
      properties:
        bullet_text:
          type: string
        skills:
          type: array
          items: { type: string }
        risk_flags:
          type: array
          items: { type: string }
      additionalProperties: false

    Education:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        school:
          type: string
        degree:
          type: string
          nullable: true
        field:
          type: string
          nullable: true
        start_date:
          type: string
          nullable: true
        end_date:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required: [id, user_id, school, created_at, updated_at]

    EducationCreateRequest:
      type: object
      properties:
        school:
          type: string
        degree:
          type: string
        field:
          type: string
        start_date:
          type: string
        end_date:
          type: string
      required: [school]

    EducationUpdateRequest:
      type: object
      properties:
        school:
          type: string
        degree:
          type: string
        field:
          type: string
        start_date:
          type: string
        end_date:
          type: string
      additionalProperties: false

    ExperienceBankExport:
      type: object
      description: Pipeline-compatible export format (structure may evolve).
      additionalProperties: true

    SseEvent:
      type: string
      description: Raw SSE event text payload (implementation-defined).

    Error:
      type: object
      properties:
        error:
          type: string
          example: bad_request
        message:
          type: string
          example: Invalid request payload
        details:
          description: Optional extra details
          oneOf:
            - type: object
              additionalProperties: true
            - type: array
              items: {}
            - type: string
      required: [error, message]

    Company:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        name_normalized:
          type: string
        domain:
          type: string
          nullable: true
        industry:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - id
        - name
        - name_normalized
        - created_at
        - updated_at

    CompanyListResponse:
      type: object
      properties:
        companies:
          type: array
          items:
            $ref: "#/components/schemas/Company"
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
      required:
        - companies
        - total
        - limit
        - offset

    CompanyDomain:
      type: object
      properties:
        id:
          type: string
          format: uuid
        company_id:
          type: string
          format: uuid
        domain:
          type: string
        domain_type:
          type: string
        created_at:
          type: string
          format: date-time
      required:
        - id
        - company_id
        - domain
        - domain_type
        - created_at

    CompanyProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        company_id:
          type: string
          format: uuid
        tone:
          type: string
        domain_context:
          type: string
          nullable: true
        version:
          type: integer
        last_verified_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        style_rules:
          type: array
          items:
            type: string
        taboo_phrases:
          type: array
          items:
            type: string
        values:
          type: array
          items:
            type: string
        evidence_urls:
          type: array
          items:
            type: string
      required:
        - id
        - company_id
        - tone
        - version
        - created_at
        - updated_at

    CompanyStyleRule:
      type: object
      properties:
        id:
          type: string
          format: uuid
        profile_id:
          type: string
          format: uuid
        rule_text:
          type: string
        priority:
          type: integer
        created_at:
          type: string
          format: date-time
      required:
        - id
        - profile_id
        - rule_text
        - priority
        - created_at

    CompanyTabooPhrase:
      type: object
      properties:
        id:
          type: string
          format: uuid
        profile_id:
          type: string
          format: uuid
        phrase:
          type: string
        reason:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
      required:
        - id
        - profile_id
        - phrase
        - created_at

    CompanyValue:
      type: object
      properties:
        id:
          type: string
          format: uuid
        profile_id:
          type: string
          format: uuid
        value_text:
          type: string
        priority:
          type: integer
        created_at:
          type: string
          format: date-time
      required:
        - id
        - profile_id
        - value_text
        - priority
        - created_at

    CompanyProfileSource:
      type: object
      properties:
        id:
          type: string
          format: uuid
        profile_id:
          type: string
          format: uuid
        crawled_page_id:
          type: string
          format: uuid
          nullable: true
        url:
          type: string
        source_type:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
      required:
        - id
        - profile_id
        - url
        - created_at

    JobPosting:
      type: object
      properties:
        id:
          type: string
          format: uuid
        company_id:
          type: string
          format: uuid
          nullable: true
        url:
          type: string
          format: uri
        role_title:
          type: string
          nullable: true
        platform:
          type: string
          nullable: true
        cleaned_text:
          type: string
          nullable: true
        content_hash:
          type: string
          nullable: true
        about_company:
          type: string
          nullable: true
        admin_info:
          $ref: "#/components/schemas/AdminInfo"
        extracted_links:
          type: array
          items:
            type: string
        http_status:
          type: integer
          nullable: true
        fetch_status:
          type: string
        error_message:
          type: string
          nullable: true
        fetched_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
          nullable: true
        last_accessed_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - id
        - url
        - fetch_status
        - fetched_at
        - last_accessed_at
        - created_at
        - updated_at

    AdminInfo:
      type: object
      properties:
        salary:
          type: string
          nullable: true
        salary_min:
          type: integer
          nullable: true
        salary_max:
          type: integer
          nullable: true
        location:
          type: string
          nullable: true
        remote_policy:
          type: string
          nullable: true
        employment_type:
          type: string
          nullable: true

    JobPostingListResponse:
      type: object
      properties:
        postings:
          type: array
          items:
            $ref: "#/components/schemas/JobPosting"
        count:
          type: integer
        limit:
          type: integer
        offset:
          type: integer
      required:
        - postings
        - count
        - limit
        - offset

    JobProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        posting_id:
          type: string
          format: uuid
        company_name:
          type: string
        role_title:
          type: string
        eval_latency:
          type: boolean
        eval_reliability:
          type: boolean
        eval_ownership:
          type: boolean
        eval_scale:
          type: boolean
        eval_collaboration:
          type: boolean
        eval_signals_raw:
          type: object
          additionalProperties: true
        education_min_degree:
          type: string
          nullable: true
        education_preferred_fields:
          type: array
          items:
            type: string
        education_is_required:
          type: boolean
        education_evidence:
          type: string
          nullable: true
        parsed_at:
          type: string
          format: date-time
        parser_version:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        responsibilities:
          type: array
          items:
            type: string
        hard_requirements:
          type: array
          items:
            $ref: "#/components/schemas/JobRequirement"
        nice_to_haves:
          type: array
          items:
            $ref: "#/components/schemas/JobRequirement"
        keywords:
          type: array
          items:
            type: string
      required:
        - id
        - posting_id
        - company_name
        - role_title
        - parsed_at
        - created_at
        - updated_at

    JobRequirement:
      type: object
      properties:
        id:
          type: string
          format: uuid
        job_profile_id:
          type: string
          format: uuid
        requirement_type:
          type: string
          enum: [hard, nice_to_have]
        skill:
          type: string
        level:
          type: string
          nullable: true
        evidence:
          type: string
          nullable: true
        ordinal:
          type: integer
        created_at:
          type: string
          format: date-time
      required:
        - id
        - job_profile_id
        - requirement_type
        - skill
        - ordinal
        - created_at

    JobRequirementListResponse:
      type: object
      properties:
        requirements:
          type: array
          items:
            $ref: "#/components/schemas/JobRequirement"
        count:
          type: integer
      required:
        - requirements
        - count

    JobResponsibility:
      type: object
      properties:
        id:
          type: string
          format: uuid
        job_profile_id:
          type: string
          format: uuid
        text:
          type: string
        ordinal:
          type: integer
        created_at:
          type: string
          format: date-time
      required:
        - id
        - job_profile_id
        - text
        - ordinal
        - created_at

    JobResponsibilityListResponse:
      type: object
      properties:
        responsibilities:
          type: array
          items:
            $ref: "#/components/schemas/JobResponsibility"
        count:
          type: integer
      required:
        - responsibilities
        - count

    JobKeyword:
      type: object
      properties:
        id:
          type: string
          format: uuid
        job_profile_id:
          type: string
          format: uuid
        keyword:
          type: string
        keyword_normalized:
          type: string
        source:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
      required:
        - id
        - job_profile_id
        - keyword
        - keyword_normalized
        - created_at

    JobKeywordListResponse:
      type: object
      properties:
        keywords:
          type: array
          items:
            $ref: "#/components/schemas/JobKeyword"
        count:
          type: integer
      required:
        - keywords
        - count

    CrawledPage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        company_id:
          type: string
          format: uuid
          nullable: true
        url:
          type: string
          format: uri
        page_type:
          type: string
          nullable: true
          enum: [values, culture, about, careers, engineering, press, other]
        parsed_text:
          type: string
          nullable: true
        content_hash:
          type: string
          nullable: true
        http_status:
          type: integer
          nullable: true
        fetch_status:
          type: string
          enum: [success, error, not_found, timeout, blocked]
        error_message:
          type: string
          nullable: true
        is_permanent_failure:
          type: boolean
        retry_count:
          type: integer
        retry_after:
          type: string
          format: date-time
          nullable: true
        fetched_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
          nullable: true
        last_accessed_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        raw_html:
          type: string
          nullable: true
          description: Only included when include_html=true query parameter is set
      required:
        - id
        - url
        - fetch_status
        - is_permanent_failure
        - retry_count
        - fetched_at
        - last_accessed_at
        - created_at
        - updated_at

    CrawledPageListResponse:
      type: object
      properties:
        pages:
          type: array
          items:
            $ref: "#/components/schemas/CrawledPage"
        count:
          type: integer
      required:
        - pages
        - count

    Story:
      type: object
      properties:
        id:
          type: string
          format: uuid
        story_id:
          type: string
          description: Human-readable story identifier
        user_id:
          type: string
          format: uuid
        job_id:
          type: string
          format: uuid
        title:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        bullets:
          type: array
          items:
            $ref: "#/components/schemas/Bullet"
      required:
        - id
        - story_id
        - user_id
        - job_id
        - created_at
        - updated_at

    Bullet:
      type: object
      properties:
        id:
          type: string
          format: uuid
        bullet_id:
          type: string
          description: Human-readable bullet identifier
        story_id:
          type: string
          format: uuid
        job_id:
          type: string
          format: uuid
          nullable: true
        text:
          type: string
        metrics:
          type: string
          nullable: true
        length_chars:
          type: integer
        evidence_strength:
          type: string
          enum: [high, medium, low]
        risk_flags:
          type: array
          items:
            type: string
        ordinal:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        skills:
          type: array
          items:
            type: string
      required:
        - id
        - bullet_id
        - story_id
        - text
        - length_chars
        - evidence_strength
        - ordinal
        - created_at
        - updated_at

    Skill:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        name_normalized:
          type: string
        category:
          type: string
          nullable: true
          enum: [programming, framework, database, tool, cloud, soft_skill, other]
        created_at:
          type: string
          format: date-time
      required:
        - id
        - name
        - name_normalized
        - created_at

    StoryListResponse:
      type: object
      properties:
        stories:
          type: array
          items:
            $ref: "#/components/schemas/Story"
        count:
          type: integer
      required:
        - stories
        - count

    BulletListResponse:
      type: object
      properties:
        bullets:
          type: array
          items:
            $ref: "#/components/schemas/Bullet"
        count:
          type: integer
      required:
        - bullets
        - count

    SkillListResponse:
      type: object
      properties:
        skills:
          type: array
          items:
            $ref: "#/components/schemas/Skill"
        count:
          type: integer
      required:
        - skills
        - count

    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          description: User's full name
        email:
          type: string
          format: email
          description: User's email address
        password:
          type: string
          format: password
          minLength: 8
          description: User's password (minimum 8 characters)
        phone:
          type: string
          nullable: true
          description: User's phone number (optional)

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
        password:
          type: string
          format: password
          description: User's password

    UpdatePasswordRequest:
      type: object
      required:
        - current_password
        - new_password
      properties:
        current_password:
          type: string
          format: password
          description: Current password
        new_password:
          type: string
          format: password
          minLength: 8
          description: New password (minimum 8 characters)

    LoginResponse:
      type: object
      required:
        - user
        - token
      properties:
        user:
          $ref: "#/components/schemas/User"
        token:
          type: string
          description: JWT token for authenticated requests
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    RunGetResponse:
      type: object
      description: Complete run metadata response
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
          nullable: true
          description: User ID (nullable for backward compatibility)
        company:
          type: string
          description: Company name
        role_title:
          type: string
          description: Job role title
        job_url:
          type: string
          format: uri
          description: Original job posting URL
        status:
          type: string
          enum: [queued, running, completed, failed, canceled]
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when run completed (null if still running)
      required: [id, company, role_title, job_url, status, created_at]

    RunStepsListResponse:
      type: object
      description: List of all steps for a run with optional run metadata
      properties:
        run_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [queued, running, completed, failed, canceled]
          description: Run-level status
        company:
          type: string
          nullable: true
          description: Company name (omitted if empty)
        role_title:
          type: string
          nullable: true
          description: Job role title (omitted if empty)
        created_at:
          type: string
          format: date-time
          description: Run creation timestamp (omitted if empty)
        steps:
          type: array
          items:
            $ref: "#/components/schemas/StepStatusResponse"
        summary:
          $ref: "#/components/schemas/RunStepsSummary"
      required: [run_id, status, steps, summary]

    StepStatusResponse:
      type: object
      description: Status of a single pipeline step
      properties:
        step:
          type: string
          description: Step name
        status:
          type: string
          enum: [pending, in_progress, completed, failed, skipped, blocked]
        run_id:
          type: string
          format: uuid
        started_at:
          type: string
          format: date-time
          nullable: true
          description: Step start time (null if not started)
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Step completion time (null if not completed)
        duration_ms:
          type: integer
          nullable: true
          description: Step duration in milliseconds (null if not completed)
        artifact_id:
          type: string
          format: uuid
          nullable: true
          description: Artifact ID produced by this step (null if no artifact)
        error:
          type: string
          nullable: true
          description: Error message (null unless status is failed)
      required: [step, status, run_id]

    RunStepsSummary:
      type: object
      description: Summary of step statuses for a run
      properties:
        total:
          type: integer
          description: Total number of steps
        completed:
          type: integer
          description: Number of completed steps
        in_progress:
          type: integer
          description: Number of steps in progress
        pending:
          type: integer
          description: Number of pending steps
        failed:
          type: integer
          description: Number of failed steps
        skipped:
          type: integer
          description: Number of skipped steps
      required: [total, completed, in_progress, pending, failed, skipped]

    StepExecuteRequest:
      type: object
      description: Request to execute a step with optional parameters
      properties:
        parameters:
          type: object
          additionalProperties: true
          description: Step-specific parameters
      additionalProperties: false

    StepExecuteResponse:
      type: object
      description: Response from step execution
      properties:
        step:
          type: string
        status:
          type: string
          enum: [pending, in_progress, completed, failed, skipped]
        run_id:
          type: string
          format: uuid
        started_at:
          type: string
          format: date-time
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true
        duration_ms:
          type: integer
          nullable: true
        artifact_id:
          type: string
          format: uuid
          nullable: true
        next_steps:
          type: array
          items:
            type: string
          description: List of next available steps
        checkpoint:
          allOf:
            - $ref: "#/components/schemas/CheckpointResponse"
          nullable: true
      required: [step, status, run_id]

    CheckpointResponse:
      type: object
      description: Checkpoint information
      properties:
        step:
          type: string
        run_id:
          type: string
          format: uuid
        completed_at:
          type: string
          format: date-time
        artifacts:
          type: object
          additionalProperties: true
          description: Artifacts available at this checkpoint
      required: [step, run_id, completed_at, artifacts]

    CheckpointGetResponse:
      type: object
      description: Full checkpoint state
      properties:
        run_id:
          type: string
          format: uuid
        checkpoint_step:
          type: string
          description: Step that created this checkpoint
        checkpoint_at:
          type: string
          format: date-time
        completed_steps:
          type: array
          items:
            type: string
          description: List of completed step names
        next_available_steps:
          type: array
          items:
            type: string
          description: List of steps that can be executed next
        artifacts:
          type: object
          additionalProperties: true
          description: All artifacts available at this checkpoint
      required: [run_id, checkpoint_step, checkpoint_at, completed_steps, next_available_steps, artifacts]

    ResumeRequest:
      type: object
      description: Request to resume from checkpoint
      properties:
        auto_continue:
          type: boolean
          default: false
          description: Automatically continue executing steps
        max_steps:
          type: integer
          minimum: 1
          nullable: true
          description: Maximum number of steps to execute (null for unlimited)
      additionalProperties: false

    ResumeResponse:
      type: object
      description: Response from resume operation
      properties:
        run_id:
          type: string
          format: uuid
        resumed_from:
          type: string
          description: Step name that was resumed from
        executed_steps:
          type: array
          items:
            type: string
          description: List of steps that were executed
        current_status:
          type: string
          enum: [queued, running, completed, failed, canceled]
          description: Current run status
        next_available_steps:
          type: array
          items:
            type: string
          description: List of steps that can be executed next
      required: [run_id, resumed_from, executed_steps, current_status, next_available_steps]
